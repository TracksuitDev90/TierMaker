/* =========================================================
   Tier Maker — CSS (dark-only, glass-first, flat labels)
========================================================= */

/* ---------- Reset ---------- */
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{
  margin:0;
  font:16px/1.45 ui-sans-serif,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  -webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;
  color:var(--text); background:var(--surface); overscroll-behavior:none;
}
img{max-width:100%;display:block}
button{font:inherit;color:inherit;background:none;border:0;cursor:pointer}
input,textarea{font:inherit;color:inherit}
:focus-visible{
  outline:2px solid transparent;
  box-shadow:0 0 0 3px rgba(139,125,255,.45);
  border-radius:8px
}
a{color:inherit;text-decoration:none}

/* ---------- Theme (dark only) ---------- */
:root{
  --surface:#0f1115; --surface-raised:#171a22; --card:#11141c;
  --text:#e8eaf0; --muted:#a7b0c0; --border:rgba(255,255,255,.08);
  --shadow:0 10px 28px rgba(0,0,0,.35);
  --accent:#8b7dff; --brand:#d8ff3f;

  --elev-ambient: 0 10px 30px rgba(0,0,0,.28);
  --elev-key: 0 2px 8px rgba(0,0,0,.35);
  --radius-xl: 18px;
  --radius-xxl: 22px;
  --easing-out: cubic-bezier(.2,.8,.2,1);
  --easing-in: cubic-bezier(.4,0,1,1);
}

/* Prefer perceptual color & mixes when supported */
@supports (color: oklch(50% 0.2 200)){
  :root{
    --surface: oklch(16% 0.012 260);
    --surface-raised: oklch(20% 0.012 260);
    --card: oklch(18% 0.012 260);
    --text: oklch(96% 0.01 260);
    --muted: oklch(70% 0.03 260);
    --accent: oklch(70% 0.14 300);
    --brand: oklch(92% 0.25 120);
    --border: color-mix(in oklch, var(--text) 8%, transparent);
  }
}

/* ---------- Layout ---------- */
.wrap{
  max-width:1200px;margin:0 auto;padding:clamp(16px,2.4vw,28px);
  display:flex;flex-direction:column;
  background-image:
    radial-gradient(1000px 500px at 10% -10%, rgba(255,255,255,.02), transparent 60%),
    radial-gradient(900px 500px at 110% 10%, rgba(0,0,0,.12), transparent 60%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.015) 0 2px, transparent 2px 4px);
  background-blend-mode: soft-light, normal, normal;
}
.header{display:flex;align-items:center;gap:14px;margin-bottom:14px}
.brand{
  font-weight:1000;letter-spacing:1px;color:var(--brand);
  font-size:clamp(31px,5.5vw,51px);position:sticky;top:14px;z-index:20
}
@media (max-width:1024px){.brand{position:static}}

/* ---------- Panels (glassy) ---------- */
.panel{
  position:relative;
  background:
    linear-gradient(var(--surface-raised), var(--surface-raised)) padding-box,
    linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.18)) border-box;
  border:1px solid transparent;
  border-radius:var(--radius-xl);
  box-shadow:var(--elev-ambient), var(--elev-key);
  padding:clamp(14px,1.8vw,18px); margin-bottom:16px; overflow:visible;
}
@supports (backdrop-filter: blur(8px)) {
  /* glass on panels + drop zones ONLY (labels are flat) */
  .panel, .tier-drop{
    background:
      linear-gradient(180deg,
        color-mix(in oklch, var(--surface-raised) 82%, transparent),
        color-mix(in oklch, var(--surface-raised) 66%, transparent)) padding-box,
      linear-gradient(145deg, rgba(255,255,255,.22), rgba(255,255,255,.04)) border-box;
    border:1px solid transparent;
    backdrop-filter: blur(14px) saturate(1.25);
  }
  .panel::before, .tier-drop::before{
    content:""; position:absolute; inset:0; pointer-events:none; border-radius:inherit;
    background:
      linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,0) 18%),
      radial-gradient(60% 40% at 50% -10%, rgba(255,255,255,.12), transparent 70%);
    mix-blend-mode:soft-light; opacity:.85;
  }
}

/* Section titles */
.section-title{font-size:clamp(18px,2vw,24px);font-weight:900;margin:0 0 14px}

/* ---------- Controls row (original; mobile only now) ---------- */
.controls{display:grid;gap:14px;grid-template-columns:repeat(4,minmax(0,1fr))}
@media (max-width:900px){.controls{grid-template-columns:repeat(3,minmax(0,1fr))}}
@media (max-width:720px){.controls{grid-template-columns:1fr 1fr}}

.btn{
  display:inline-flex;align-items:center;justify-content:center;gap:10px;
  height:56px;padding:0 18px;border-radius:var(--radius-xxl);
  background:var(--surface);color:var(--text);
  border:1px solid rgba(255,255,255,.08);
  box-shadow:0 .5px 0 rgba(255,255,255,.12) inset, 0 10px 24px rgba(0,0,0,.25);
  transition:transform .08s ease,background .2s ease,border-color .2s ease,filter .2s ease;
}
.btn:hover{transform:translateY(-1px)}
.btn:active{transform:translateY(0);filter:brightness(.98)}
.btn .ico{width:22px;height:22px;display:grid;place-items:center}
.btn .ico svg,.btn .ico img{width:22px;height:22px;display:block}

/* Buttons — flat colors */
#addTierBtn{background:#02ec88;color:#111111;border-color:rgba(0,0,0,.12)}
#undoBtn{background:#ffcc3f;color:#111111;border-color:rgba(0,0,0,.12)}
#trashClear{background:#F05C58;color:#111111;border-color:rgba(255,255,255,.18)}
#saveBtn{background:#7901ff;color:#FFF;border-color:rgba(255,255,255,.15)}

.btn.small{height:42px;padding:0 12px;border-radius:12px;font-weight:700}

/* Bounce on click */
@keyframes btn-bounce{0%{transform:scale(1)}30%{transform:scale(1.08)}60%{transform:scale(0.98)}100%{transform:scale(1)}}
.btn.bounce-anim{animation:btn-bounce .48s cubic-bezier(.34,1.56,.64,1)}

/* ---------- Creator ---------- */
.creator-grid{display:grid;gap:12px}
.creator-line{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.input{flex:1 1 260px;height:48px;padding:0 14px;background:var(--card);color:var(--text);border:1px solid var(--border);border-radius:12px}
.color-dot{width:40px;height:40px;border-radius:999px;border:3px solid var(--surface-raised);box-shadow:0 4px 18px rgba(0,0,0,.25) inset,0 2px 8px rgba(0,0,0,.2)}
.help{color:var(--muted);font-weight:600;margin-top:10px}
.help strong{color:var(--accent)}

/* ---------- Board ---------- */
.board-title-wrap{display:flex;align-items:center;gap:8px;margin:0 0 18px}
.title-pen{display:inline-flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:8px;background:transparent;border:0;margin-right:4px;opacity:.75}
.title-pen:hover{opacity:1}
.title-pen svg{width:18px;height:18px;fill:currentColor;opacity:.9;display:block}
.board-title{font-size:clamp(20px,2.2vw,28px);font-weight:900;margin:0;letter-spacing:.2px;text-shadow:0 1px 0 rgba(0,0,0,.25)}
.board-title[contenteditable]:empty::before{content:'Tier Board (optional title)';color:var(--muted)}
.board-title[contenteditable="true"]{border-bottom:2px dashed rgba(139,125,255,.45);border-radius:0}
.board-title[contenteditable="true"]:focus{outline:0; box-shadow:none;border-bottom:2px solid rgba(139,125,255,.85)}

.exporting .title-pen{display:none!important}
.exporting .board-title[contenteditable]{border:0!important}
.exporting .board-title[contenteditable]:empty::before{content:''}
.exporting.no-title .board-title-wrap{display:none!important}

/* ---------- Tier board grid ---------- */
#tierBoard{display:grid;gap:12px}
.tier-row{
  position:relative;
  display:grid;grid-template-columns:180px 1fr;gap:12px;align-items:stretch;
  transition:max-height .28s ease, opacity .24s ease, box-shadow .25s var(--easing-out), transform .25s var(--easing-out);
  overflow:hidden;border-radius:var(--radius-xl);
  box-shadow:var(--elev-ambient);
}
.tier-row:hover{
  box-shadow:
    0 20px 44px rgba(0,0,0,.40),
    0 6px 18px rgba(0,0,0,.32);
  transform:translateY(-1px);
}
.tier-row.removing{max-height:0!important;opacity:0}
@media (max-width:768px){
  #tierBoard{gap:16px}
  .tier-row{grid-template-columns:140px 1fr}
}

/* --- TIER LABEL COLUMN: flat color, no glass/no glow --- */
.tier-label{
  position:relative;
  background:transparent;      /* JS sets a solid color inline */
  border:1px solid rgba(0,0,0,.14);
  border-radius:16px;
  padding:12px;
  display:flex; align-items:center; justify-content:center;
  min-height:calc(110px + 28px);
  overflow:hidden;
  box-shadow:none;             /* flat */
}
.tier-label::before{content:none !important;} /* no glass highlight */

.label-chip{
  position:relative;width:100%;max-width:100%;
  background:transparent;color:#111;
  display:flex;align-items:center;justify-content:center;
  font-weight:900;font-size:32px;line-height:1.15;
  text-transform:uppercase;letter-spacing:.5px;user-select:none;
  white-space:normal;text-align:center;
  padding:10px 12px 12px; /* avoid descender clipping */
  overflow:hidden;word-break:break-word;hyphens:auto;overflow-wrap:break-word;
}
.row-handle{display:none}

/* Row delete X */
.row-del{
  position:absolute;right:8px;bottom:8px;width:36px;height:36px;border-radius:9px;
  color:#fff;display:grid;place-items:center;
  box-shadow:0 6px 14px rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.18);
  font-weight:900;z-index:8;
}
.row-del svg{width:16px;height:16px;fill:currentColor}
.exporting .row-del{display:none!important}

/* Drops (glassy) */
.tier-drop{
  position:relative;
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
  display:grid;grid-auto-flow:row;grid-template-columns:repeat(auto-fill,minmax(116px,1fr));
  align-content:start;gap:10px;            /* tightened by 4px */
  min-height:calc(110px + 28px);
  will-change:contents;
  box-shadow:var(--elev-ambient), var(--elev-key);
}
.tier-drop:focus-visible{box-shadow:0 0 0 3px rgba(139,125,255,.35),var(--shadow)}
.dropzone.drag-over{box-shadow:0 0 0 3px rgba(139,125,255,.35),var(--shadow)}
@media (max-width:768px){
  .tier-drop{grid-template-columns:repeat(auto-fill,minmax(96px,1fr))}
}

/* Ambient sweep on desktop when a token lands */
@keyframes drop-sweep{from{background-position:-200% 0}to{background-position:200% 0}}
@media (hover:hover){
  .tier-drop::after{content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none; opacity:0;}
  .tier-drop:has(.token.animate-drop)::after{
    background:linear-gradient(90deg, transparent, rgba(255,255,255,.10), transparent);
    background-size:200% 100%;
    animation:drop-sweep .9s var(--easing-out);
    opacity:1;
  }
}

/* ---------- Tokens ---------- */
.token{
  position:relative;width:110px;height:110px;border-radius:999px;background:#7da7ff;
  display:flex;align-items:center;justify-content:center;
  user-select:none;cursor:pointer;transform:translateZ(0);
  transition:transform .18s var(--easing-out), box-shadow .18s var(--easing-out), filter .2s;
  will-change:transform;
  border:1px solid rgba(255,255,255,.06);
  box-shadow:
    0 .5px 0 rgba(255,255,255,.25) inset,
    0 -1px 8px rgba(0,0,0,.25) inset,
    0 10px 24px rgba(0,0,0,.30), 0 2px 6px rgba(0,0,0,.22);
}
.token:hover{transform:translateY(-2px) scale(1.015)}
.token:active{transform:translateY(0) scale(.995)}
.token:focus-visible{outline:3px solid var(--accent);outline-offset:4px}
.token .label{
  padding:0 14px;text-align:center;font-weight:900;font-size:18px;line-height:1;
  display:flex;align-items:center;justify-content:center;height:100%;
  word-break:break-word;hyphens:auto;white-space:pre-wrap;
}
.token img{width:100%;height:100%;object-fit:cover;border-radius:999px;pointer-events:none}
.token.selected{outline:3px solid var(--accent);outline-offset:4px}

/* subtle rim light */
.token::after{
  content:""; position:absolute; inset:0; border-radius:999px;
  background:radial-gradient(120% 120% at 30% 20%, rgba(255,255,255,.35), transparent 60%);
  pointer-events:none; mix-blend-mode:soft-light; opacity:.65;
}

/* Smaller tokens on mobile */
@media (max-width:768px){
  .token{width:96px;height:96px}
}

/* Drag feedback */
.token.dragging-cue{ transform:scale(1.05); box-shadow:0 8px 20px rgba(0,0,0,.4) }
@keyframes glint-pulse{ 0%,100%{opacity:.45;transform:scale(1)} 50%{opacity:.68;transform:scale(1.035)} }
.drag-ghost,.token.dragging-cue{ isolation:isolate; }
.drag-ghost::before,.token.dragging-cue::before{
  content:""; position:absolute; inset:-2px; border-radius:999px; pointer-events:none;
  background:radial-gradient(120% 95% at 28% 22%, rgba(255,255,255,.55), rgba(255,255,255,.22) 36%, transparent 60%);
  mix-blend-mode:screen; animation:glint-pulse .9s ease-in-out infinite;
}

/* FLIP + drop animations */
.token.flip-anim{transition:transform 180ms ease}
.drag-ghost{
  position:fixed;left:0;top:0;z-index:50;pointer-events:none;width:110px;height:110px;border-radius:999px;
  opacity:.92;transform:translate3d(0,0,0);will-change:transform;filter:drop-shadow(0 18px 28px rgba(0,0,0,.45))
}
@media (max-width:768px){.drag-ghost{width:96px;height:96px}}
.drag-hidden{opacity:.25}
body.dragging-item{cursor:grabbing;user-select:none;-webkit-user-select:none}
@keyframes pop-in{from{transform:scale(.94)}to{transform:scale(1)}}
.animate-drop{animation:pop-in .18s ease}

/* ---------- Image Storage ---------- */
#tray{
  background:var(--surface-raised);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);
  padding:16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(116px,1fr));gap:14px;
}
@media (max-width:768px){
  #tray{grid-template-columns:repeat(auto-fill,minmax(96px,1fr))}
}

/* ---------- A11y ---------- */
.sr,.sr-only{position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0 0 0 0);clip-path:inset(50%);white-space:nowrap}

/* ---------- Radial picker (mobile) ---------- */
.radial{position:fixed;inset:0;z-index:60;pointer-events:auto;filter:drop-shadow(0 8px 24px rgba(0,0,0,.35));touch-action:none;}
.radial.hidden{display:none}
.radial-options{position:relative;width:100%;height:100%}
.radial-option{position:absolute;width:56px;height:56px;border-radius:999px;transform:translate(-50%,-50%)}
.radial-option .dot{
  width:42px;height:42px;border-radius:999px;display:grid;place-items:center;
  font-weight:900;font-size:13px;background:#fff;color:#111;
  border:1px solid rgba(0,0,0,.1);box-shadow:0 2px 10px rgba(0,0,0,.15);
  transform:scale(.2);opacity:0;transition:transform .16s ease,opacity .16s ease,box-shadow .12s ease,border-color .12s ease;
}
.radial.visible .dot,.radial.show .dot{opacity:1;transform:scale(1)}
.radial-option.is-hot .dot{border-color:var(--accent);box-shadow:0 4px 14px rgba(0,0,0,.22);transform:scale(1.06)}
.radial-close{position:absolute;transform:translate(-50%,-50%);width:44px;height:44px;border-radius:999px;border:1px solid var(--border);background:var(--surface-raised);color:var(--text);display:grid;place-items:center;box-shadow:0 2px 10px rgba(0,0,0,.25)}
.radial-close svg{width:22px;height:22px;fill:currentColor}

/* Remove backdrop blur on mobile picker for clarity */
@media (max-width:768px){
  .radial{backdrop-filter:none !important;background:transparent !important}
}

/* ---------- Export safety ---------- */
.exporting .token,
.exporting .token:hover,
.exporting .animate-drop,
.exporting .flip-anim{ transform:none !important; }

.exporting .panel,
.exporting .tier-drop{
  backdrop-filter:none !important;
  background: var(--surface-raised) !important;
  border-color: var(--border) !important;
}
.exporting .tier-label{box-shadow:none!important}
.exporting.desktop-capture .wrap{max-width:1200px;width:1200px}
.exporting.desktop-capture .tier-row{grid-template-columns:180px 1fr !important}
.exporting.desktop-capture .controls{grid-template-columns:repeat(4,minmax(0,1fr)) !important}

/* ---------- Desktop inline-controls inside Image Storage ---------- */
@media (min-width:1024px){
  .controls-inline{display:flex; gap:12px; align-items:center; flex-wrap:nowrap;
    /* nudge toward center for balance across widths */
    margin-left:clamp(40px, 9vw, 180px);
  }
  .controls-inline .btn{height:44px; padding:0 14px; border-radius:14px; font-weight:800}
  .controls-inline .ico svg,.controls-inline .ico img{width:18px;height:18px}
  .controls-merged .controls-panel{ display:none !important; }

  /* Title + buttons on one line; centered-ish balance */
  .section-bar{
    display:flex;
    align-items:center;
    justify-content:flex-start;
    column-gap:12px;
    row-gap:8px;
    margin-bottom:12px;
  }
  .section-bar .section-title{margin:0}
}

/* ---------- Misc ---------- */
.hide-on-desktop{display:none}
@media (max-width:768px){.hide-on-desktop{display:initial}}
@media print{body{background:#fff;color:#000}.panel,#tray,.controls,.creator-grid{box-shadow:none;border-color:#ddd}.token.selected,.token:focus-visible{outline-color:#000}}
@media (prefers-reduced-motion:reduce){*{transition:none!important;animation:none!important}}